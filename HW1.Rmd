---
title: "HW1"
output: html_document

---

```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(ggplot2)
```

## Question 1

#### Question 1(b)
```{r chunk_Q1b, message=FALSE, warning=FALSE}
k1 = 600
k2 = 300
rho_1 = 0.2
rho_2 = 0.5
rho_3 = 0.8
rho = c(rho_1, rho_2, rho_3)
V_a = c(1, 1, 1)*4/k1
V_b = c(1, 1, 1)*8*(1-rho)/k2
V_c = c(1, 1, 1)*2*(1-rho)/k2
V_d = c(1, 1, 1)*2*(rho+1)/k2
b  = cbind(rho, V_a, V_b, V_c, V_d) %>% as.data.frame()
options(digits = 2)
print(b)
```
For minimum variance, for any $\rho$, I would always choose Crossover study to minimize uncertainty.

#### Question 1(c)
```{r chunk_Q1c, message=FALSE, warning=FALSE}
k1 = 600
k2 = 400
rho_1 = 0.2
rho_2 = 0.5
rho_3 = 0.8
rho = c(rho_1, rho_2, rho_3)
V_a = c(1, 1, 1)*4/k1
V_b = c(1, 1, 1)*8*(1-rho)/k2
V_c = c(1, 1, 1)*2*(1-rho)/k2
V_d = c(1, 1, 1)*2*(rho+1)/k2
c  = cbind(rho, V_a, V_b, V_c, V_d) %>% as.data.frame()
options(digits = 2)
print(c)
```
For minimum variance, for any $\rho$, I would always choose Crossover study to minimize uncertainty.

## Question 2

#### Question 2(a)
```{r chunk_Q2a, message=FALSE, warning=FALSE}
load("~/Documents/2023Fall/P8157/P8157/Six Cities.RData")
# data summmary
nrow(topeka)
length(unique(topeka$id))
visit = topeka %>% group_by(id) %>%tally()
summary(visit$n)
skimr::skim(topeka)
# outlier
topeka %>% ggplot(aes(x = log.FEV1)) + geom_boxplot()
# spaghetti plot
ggplot(topeka, aes(x = age, y = log.FEV1, group = id, color = id)) + 
  geom_line() + 
  scale_x_continuous(breaks = c(5, 10, 15, 20)) +
  scale_y_continuous(limits = c(-0.25, 1.5))
# dependence
pairs(topeka)
corrplot::corrplot(cor(topeka[]))
```

There are 5 variables and 1 outcome in the topeka dataset, which consists of 300 clusters with 1994 measurements. Number of measurements within each cluster ranges from 1 to 12, with mean being 6.6 and median being 7. The mean age of the subjects upon their recruitment was 8.03, while the height was 1.28m. For simplicity, the age and height variables could be standardized when conducting the longitudal analysis. One outlier of the outcome log.FEV1 was observed which should be further investigated. In the correlation plot one can see that the covariates age and height are highly correlated, indicating they might be dependent of each other. 

#### Question 2(b)

#### Question 2(c)

## Question 3

```{r}
load("~/Documents/2023Fall/P8157/P8157/MACS.RData")
dmm = macs %>%
  filter(time >= -0.5) %>% 
  group_by(id) %>%
  filter(any(-0.5 <= time & time < 0) && any(time > 0)) %>%
  mutate(visit = row_number() - 1,
         idd = group_indices()) %>%
  ungroup() 

length(unique(dmm$id))
```

#### Question 3(a)

```{r}
sum = skimr::skim(dmm)
sum
```

#### Question 3(b)

```{r}
K = 266
# spaghetti plot
ggplot(dmm, aes(x = time, y = cd4, group = id, color = id)) + 
  geom_line()

# Stage 1
betaMat = data.frame(beta0=rep(NA, K), beta.time=rep(NA, K))

for(k in 1:K) {
  temp.k = dmm[dmm$idd == k,]
  fit.k = lm(cd4 ~ time , data = temp.k)
  betaMat[k, 1:2] = c(fit.k$coef)
}

# 

```


